(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{315:function(t,n,s){"use strict";s.r(n);var a=s(6),e=Object(a.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"mmdetection训练报错汇总"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mmdetection训练报错汇总"}},[t._v("#")]),t._v(" mmdetection训练报错汇总")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("one of the variables needed for gradient computation has been modified by an inplace operation")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("详细报错信息")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("Traceback "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("most recent call last"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tools/train.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("242")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tools/train.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("231")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" main\n    train_detector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/code/mmlab/mmdetection/mmdet/apis/train.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("244")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" train_detector\n    runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data_loaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cfg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workflow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/miniconda3/envs/mmlab/lib/python3.8/site-packages/mmcv/runner/epoch_based_runner.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" run\n    epoch_runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data_loaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/miniconda3/envs/mmlab/lib/python3.8/site-packages/mmcv/runner/epoch_based_runner.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" train\n    self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call_hook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'after_train_iter'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/miniconda3/envs/mmlab/lib/python3.8/site-packages/mmcv/runner/base_runner.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("309")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" call_hook\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("getattr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hook"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/miniconda3/envs/mmlab/lib/python3.8/site-packages/mmcv/runner/hooks/optimizer.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" after_train_iter\n    runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("outputs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loss'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backward"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/miniconda3/envs/mmlab/lib/python3.8/site-packages/torch/tensor.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("245")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" backward\n    torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autograd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backward"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gradient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" retain_graph"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" create_graph"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inputs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("inputs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/lgh/miniconda3/envs/mmlab/lib/python3.8/site-packages/torch/autograd/__init__.py"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" line "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("145")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" backward\n    Variable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_execution_engine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run_backward"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\nRuntimeError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" one of the variables needed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" gradient computation has been modified by an inplace operation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cuda"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FloatTensor "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" which "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" output "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" of ReluBackward1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" at version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" expected version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" instead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" Hint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" enable anomaly detection to find the operation that failed to compute its gradient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" torch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autograd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set_detect_anomaly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("问题分析:"),n("br"),t._v("\n所谓inplace操作就是直接修改地址上的值。")]),t._v(" "),n("p",[t._v("首先是torch中所有加 _ 的函数，x.squeeze_()，x.unsqueeze_()。这些操作直接修改变量，不返回值。")]),t._v(" "),n("p",[t._v("其次一些函数可以通过设置是否inplace，比如Pytorch中 torch.relu()和torch.sigmoid()等激活函数不是inplace操作，其中ReLU可通过设置inplace=True进行inplace操作。")]),t._v(" "),n("p",[t._v("以及一些算术操作，x += res是inplace操作，x = x + res不是。以及一些赋值操作。")]),t._v(" "),n("p",[t._v("如果一些用于backward的值被inplace操作修改了就会报错，所以最好不使用inplace操作，以及将赋值操作放在各种需要计算梯度运算之前，gather要在赋值之后。")])]),t._v(" "),n("li",[n("p",[t._v("解决方案："),n("br"),t._v("\n将"),n("code",[t._v("ReLu")]),t._v("的"),n("code",[t._v("inplace=True")]),t._v("移除")])]),t._v(" "),n("li",[n("p",[t._v("参考文章："),n("br"),t._v(" "),n("a",{attrs:{href:"https://blog.csdn.net/qq_38163755/article/details/110957133",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/qq_38163755/article/details/110957133"),n("OutboundLink")],1)])])])])])])}),[],!1,null,null,null);n.default=e.exports}}]);